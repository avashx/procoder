<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NSUT ke Pro Coder</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #F9FAFB;
      margin: 0;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #1F2937;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark-theme {
      background-color: #111827;
      color: #FBBF24;
    }
    body.ultra-fast {
      color: #F97316;
    }
    body.dark-theme.ultra-fast {
      color: #F97316;
    }
    .container {
      width: 100%;
      max-width: 420px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex-grow: 1;
    }
    .nav-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      width: 100%;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    nav {
      display: flex;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      background-color: #FFFFFF;
      padding: 8px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s;
      width: 100%;
      max-width: 420px;
    }
    body.dark-theme nav {
      background-color: #1F2937;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .nav-links {
      display: flex;
      gap: 10px;
    }
    nav a {
      color: #1F2937;
      text-decoration: none;
      font-size: 16px;
      padding: 8px 16px;
      border-radius: 8px;
      transition: background 0.2s, color 0.3s;
    }
    body.dark-theme nav a {
      color: #FBBF24;
    }
    body.ultra-fast nav a {
      color: #F97316;
    }
    body.dark-theme.ultra-fast nav a {
      color: #F97316;
    }
    nav a:hover {
      background: #FBBF2444;
    }
    body.dark-theme nav a:hover {
      background: #FBBF2422;
    }
    body.ultra-fast nav a:hover {
      background: #F9731622;
    }
    nav a.active {
      border: 2px solid #FBBF24;
      padding: calc(8px - 2px) calc(16px - 2px);
    }
    body.dark-theme nav a.active {
      border-color: #FBBF24;
    }
    body.ultra-fast nav a.active {
      border-color: #F97316;
    }
    .toggle-switch {
      position: relative;
      width: 40px;
      height: 20px;
      background-color: #D1D5DB;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    body.dark-theme .toggle-switch {
      background-color: #4B5563;
    }
    .toggle-switch::before {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background-color: #FBBF24;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.3s;
    }
    body.dark-theme .toggle-switch::before {
      transform: translateX(20px);
    }
    h1 {
      font-size: 24px;
      margin: 8px 0;
      text-align: center;
      font-weight: 700;
      text-transform: uppercase;
    }
    textarea {
      width: 100%;
      min-height: 150px;
      max-height: 400px;
      border: 2px solid #FBBF24;
      border-radius: 12px;
      padding: 12px;
      font-size: 16px;
      resize: vertical;
      box-sizing: border-box;
      background-color: #FFFFFF;
      color: #1F2937;
      font-family: 'Fira Code', monospace;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme textarea {
      background-color: #1F2937;
      color: #FBBF24;
      border-color: #FBBF24;
    }
    body.ultra-fast textarea {
      border-color: #F97316;
      color: #1F2937;
    }
    body.dark-theme.ultra-fast textarea {
      border-color: #F97316;
      color: #FBBF24;
    }
    textarea::after {
      content: '';
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 12px;
      height: 12px;
      background: #FBBF24 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M20 20H4V4h16v16zM10 4L4 10h6V4zm10 10v6h-6l6-6z"/></svg>') no-repeat center;
      background-size: 8px;
      cursor: ns-resize;
      border-radius: 4px;
    }
    body.dark-theme textarea::after {
      background-color: #FBBF24;
    }
    body.ultra-fast textarea::after {
      background-color: #F97316;
    }
    label {
      font-size: 14px;
      margin-bottom: 4px;
      transition: color 0.3s;
    }
    body.dark-theme label {
      color: #FBBF24;
    }
    select {
      width: 100%;
      padding: 10px;
      border: 2px solid FBBF24;
      border-radius: 8px;
      font-size: 16px;
      background-color: #FFFFFF;
      color: #1F2937;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme select {
      background-color: #1F2937;
      color: #FBBF24;
      border-color: #FBBF24;
    }
    body.ultra-fast select {
      border-color: #F97316;
      color: #1F2937;
    }
    body.dark-theme.ultra-fast select {
      border-color: #F97316;
      color: #FBBF24;
    }
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #D1D5DB;
      border-radius: 4px;
      outline: none;
      transition: background 0.3s;
      position: relative;
    }
    body.dark-theme input[type="range"] {
      background: #4B5563;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      background: transparent;
    }
    input[type="range"]::-moz-range-track {
      background: transparent;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #FBBF24;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.3s;
      position: relative;
      z-index: 2;
    }
    body.dark-theme input[type="range"]::-webkit-slider-thumb {
      background: #FBBF24;
    }
    body.ultra-fast input[type="range"]::-webkit-slider-thumb {
      background: #F97316;
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #FBBF24;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.3s;
    }
    body.dark-theme input[type="range"]::-moz-range-thumb {
      background: #FBBF24;
    }
    body.ultra-fast input[type="range"]::-moz-range-thumb {
      background: #F97316;
    }
    input[type="range"]::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 8px;
      border-radius: 4px;
      background: #FBBF24;
      transition: background 0.3s;
      z-index: 1;
    }
    body.dark-theme input[type="range"]::before {
      background: #FBBF24;
    }
    body.ultra-fast input[type="range"]::before {
      background: #F97316;
    }
    .speed-section {
      border: 2px solid #FBBF24;
      border-radius: 12px;
      padding: 12px;
      background: #FFFFFF;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme .speed-section {
      background: #1F2937;
      border-color: #FBBF24;
    }
    body.ultra-fast .speed-section {
      border-color: #F97316;
    }
    .speed-section h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      text-align: center;
    }
    .speed-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .control-section {
      border: 2px solid #FBBF24;
      border-radius: 12px;
      padding: 12px;
      background: #FFFFFF;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme .control-section {
      background: #1F2937;
      border-color: #FBBF24;
    }
    body.ultra-fast .control-section {
      border-color: #F97316;
    }
    .control-section h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      text-align: center;
    }
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toggle-wrapper {
      position: relative;
      width: 40px;
      height: 20px;
    }
    input[type="checkbox"] {
      opacity: 0;
      position: absolute;
      width: 40px;
      height: 20px;
      cursor: pointer;
    }
    .toggle-slider {
      position: absolute;
      top: 0;
      left: 0;
      width: 40px;
      height: 20px;
      background-color: #D1D5DB;
      border-radius: 10px;
      transition: background-color 0.3s;
    }
    body.dark-theme .toggle-slider {
      background-color: #4B5563;
    }
    input[type="checkbox"]:checked + .toggle-slider {
      background-color: #FBBF24;
    }
    body.dark-theme input[type="checkbox"]:checked + .toggle-slider {
      background-color: #FBBF24;
    }
    body.ultra-fast input[type="checkbox"]:checked + .toggle-slider {
      background-color: #F97316;
    }
    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background-color: #FFFFFF;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.3s;
    }
    input[type="checkbox"]:checked + .toggle-slider::before {
      transform: translateX(20px);
    }
    .live-speed-graph {
      width: 100%;
      height: 120px;
      background: #FFFFFF;
      border: 2px solid #FBBF24;
      border-radius: 12px;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      display: none;
    }
    body.dark-theme .live-speed-graph {
      background: #1F2937;
      border-color: #FBBF24;
    }
    body.ultra-fast .live-speed-graph {
      border-color: #F97316;
    }
    .live-speed-graph canvas {
      width: 100%;
      height: 100%;
    }
    .button-container {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease, background 0.3s, color 0.3s;
      background: #FBBF24;
      color: #1F2937;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme button {
      background: #FBBF24;
      color: #1F2937;
    }
    body.ultra-fast button {
      background: #F97316;
    }
    button:hover:not(:disabled) {
      background: #D97706;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(251, 191, 36, 0.3);
    }
    body.dark-theme button:hover:not(:disabled) {
      background: #D97706;
      box-shadow: 0 6px 16px rgba(251, 191, 36, 0.3);
    }
    body.ultra-fast button:hover:not(:disabled) {
      background: #EA580C;
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.3);
    }
    #start-button {
      background: linear-gradient(to right, #10B981, #059669);
      font-size: 18px;
      padding: 14px;
    }
    #start-button:hover:not(:disabled) {
      background: linear-gradient(to right, #059669, #10B981);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5);
    }
    #start-button:disabled {
      background: #D1D5DB;
      color: #9CA3AF;
      cursor: not-allowed;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme #start-button:disabled {
      background: #4B5563;
      color: #6B7280;
    }
    #pause-button {
      background: linear-gradient(to right, #EF4444, #DC2626);
      font-size: 18px;
      padding: 14px;
    }
    #pause-button:hover:not(:disabled) {
      background: linear-gradient(to right, #DC2626, #EF4444);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.5);
    }
    #pause-button:disabled {
      background: #D1D5DB;
      color: #9CA3AF;
      cursor: not-allowed;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    body.dark-theme #pause-button:disabled {
      background: #4B5563;
      color: #6B7280;
    }
    #random-button, #ultra-button {
      font-size: 14px;
      padding: 10px 12px;
    }
    #ultra-button .wpm-label {
      font-size: 12px;
      opacity: 0.5;
    }
    footer {
      font-size: 12px;
      color: #1F2937;
      opacity: 0.5;
      text-align: center;
      margin-top: 16px;
      transition: color 0.3s;
    }
    body.dark-theme footer {
      color: #FBBF24;
    }
    body.ultra-fast footer {
      color: #F97316;
    }
    body.dark-theme.ultra-fast footer {
      color: #F97316;
    }
    @media (max-width: 400px) {
      .container { padding: 0 8px; }
      h1 { font-size: 20px; }
      textarea { min-height: 120px; }
      button { padding: 10px; font-size: 14px; }
      #start-button, #pause-button { font-size: 16px; padding: 12px; }
      #random-button, #ultra-button { font-size: 12px; padding: 8px 10px; }
      nav { padding: 4px 8px; }
      nav a { padding: 6px 12px; font-size: 14px; }
    }
  </style>
</head>
<body class="light-theme">
  <div class="nav-container">
    <nav class="navbar">
      <div class="nav-links">
        <a href="/" class="active" aria-label="Main page">Main</a>
        <a href="/coder" aria-label="Coder mode">Coder</a>
        <a href="/live" aria-label="Live mode">Live</a>
        <a href="/wifi" aria-label="Wi-Fi setup">Wi-Fi</a>
      </div>
      <div class="toggle-switch" onclick="toggleTheme()" aria-label="Toggle theme"></div>
    </nav>
  </div>
  <div class="container">
    <h1>NSUT ke Pro Coder</h1>
    <textarea id="textInput" placeholder="Enter code or text here" aria-label="Text input for typing"></textarea>
    <div class="speed-section">
      <h3>Speed</h3>
      <div class="speed-buttons">
        <button id="random-button" onclick="toggleRandom()" aria-label="Toggle random speed">Random</button>
        <button id="ultra-button" onclick="toggleUltra()" aria-label="Toggle ultra fast mode">Ultra Fast</button>
      </div>
      <label for="speed">Typing Speed (WPM): <span id="speedValue">45</span></label>
      <input type="range" id="speed" min="20" max="80" value="45" oninput="updateSpeedValue()" aria-label="Typing speed slider">
    </div>
    <div class="live-speed-graph" id="liveSpeedGraph">
      <canvas id="speedGraph"></canvas>
    </div>
    <div>
      <label for="typo">Typo Chance (%): <span id="typoValue">5</span></label>
      <input type="range" id="typo" min="0" max="10" value="5" oninput="updateTypoValue()" aria-label="Typo chance slider">
    </div>
    <div class="toggle-container">
      <label for="typos">Enable Typos</label>
      <div class="toggle-wrapper">
        <input type="checkbox" id="typos" checked onchange="debounceSettings()" aria-label="Enable typos toggle">
        <span class="toggle-slider"></span>
      </div>
    </div>
    <div class="toggle-container">
      <label for="mode">Typing Mode: <span id="modeLabel">Block</span></label>
      <div class="toggle-wrapper">
        <input type="checkbox" id="mode" onchange="updateModeLabel()" aria-label="Typing mode toggle">
        <span class="toggle-slider"></span>
      </div>
    </div>
    <div class="control-section">
      <h3>Controls</h3>
      <div class="button-container">
        <button id="start-button" onclick="startTyping()" aria-label="Start typing">Start Typing</button>
        <button id="pause-button" onclick="pauseTyping()" disabled aria-label="Pause typing">Pause Typing</button>
      </div>
    </div>
  </div>
  <footer>Developed by Vashishth</footer>
  <script>
    let isRandomSpeed = false;
    let isUltraFast = false;
    let settingsTimeout = null;

    function loadTheme() {
      const theme = localStorage.getItem('theme') || 'light';
      document.body.classList.toggle('dark-theme', theme === 'dark');
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-theme');
      const theme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
    }

    function updateSpeedValue() {
      const slider = document.getElementById('speed');
      const value = slider.value;
      document.getElementById('speedValue').textContent = value;
      const percentage = ((value - slider.min) / (slider.max - slider.min)) * 100;
      slider.style.setProperty('--filled-width', percentage + '%');
      debounceSettings();
    }

    function updateTypoValue() {
      const slider = document.getElementById('typo');
      const value = slider.value;
      document.getElementById('typoValue').textContent = value;
      const percentage = ((value - slider.min) / (slider.max - slider.min)) * 100;
      slider.style.setProperty('--filled-width', percentage + '%');
      debounceSettings();
    }

    document.querySelectorAll('input[type="range"]').forEach(slider => {
      slider.style.setProperty('--filled-width', '0%');
      slider.addEventListener('input', () => {
        const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
        slider.style.setProperty('--filled-width', percentage + '%');
      });
    });

    function updateModeLabel() {
      const mode = document.getElementById('mode').checked ? 'line' : 'block';
      document.getElementById('modeLabel').textContent = mode === 'block' ? 'Block' : 'Line-by-Line';
      debounceSettings();
    }

    function toggleRandom() {
      isRandomSpeed = !isRandomSpeed;
      if (isRandomSpeed) isUltraFast = false;
      document.getElementById('random-button').classList.toggle('active', isRandomSpeed);
      document.getElementById('random-button').textContent = isRandomSpeed ? 'Fixed Speed' : 'Random';
      document.getElementById('ultra-button').classList.toggle('active', isUltraFast);
      document.getElementById('ultra-button').innerHTML = isUltraFast ? 'Normal Mode <span class="wpm-label">(300WPM)</span>' : 'Ultra Fast';
      document.body.classList.toggle('ultra-fast', isUltraFast);
      debounceSettings();
    }

    async function toggleUltra() {
      isUltraFast = !isUltraFast;
      if (isUltraFast) isRandomSpeed = false;
      document.body.classList.toggle('ultra-fast', isUltraFast);
      document.getElementById('ultra-button').classList.toggle('active', isUltraFast);
      document.getElementById('ultra-button').innerHTML = isUltraFast ? 'Normal Mode <span class="wpm-label">(300WPM)</span>' : 'Ultra Fast';
      document.getElementById('random-button').classList.toggle('active', isRandomSpeed);
      document.getElementById('random-button').textContent = isRandomSpeed ? 'Fixed Speed' : 'Random';
      debounceSettings();
    }

    function debounceSettings() {
      clearTimeout(settingsTimeout);
      settingsTimeout = setTimeout(submitSettings, 300);
    }

    async function submitSettings() {
      const text = document.getElementById('textInput').value;
      const speed = parseInt(document.getElementById('speed').value);
      const typo = parseInt(document.getElementById('typo').value);
      const mode = document.getElementById('mode').checked ? 'line' : 'block';
      const typos = document.getElementById('typos').checked;
      try {
        const response = await fetch('https://procoders.vercel.app/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, speed, typo, mode, random: isRandomSpeed, ultra: isUltraFast, typos })
        });
        return response.ok;
      } catch (error) {
        console.error('Submit settings failed:', error);
        return false;
      }
    }

    async function startTyping() {
      if (await submitSettings()) {
        try {
          const response = await fetch('https://procoders.vercel.app/start');
          if (response.ok) {
            document.getElementById('start-button').disabled = true;
            document.getElementById('pause-button').disabled = false;
            document.getElementById('liveSpeedGraph').style.display = 'block';
            updateSpeedGraph();
          } else {
            alert('No text to type!');
          }
        } catch (error) {
          alert('Failed to start typing!');
        }
      } else {
        alert('Failed to submit settings!');
      }
    }

    async function pauseTyping() {
      try {
        const response = await fetch('https://procoders.vercel.app/pause');
        if (response.ok) {
          document.getElementById('start-button').disabled = false;
          document.getElementById('pause-button').disabled = true;
          document.getElementById('liveSpeedGraph').style.display = 'none';
          clearInterval(window.graphInterval);
        }
      } catch (error) {
        console.error('Pause failed:', error);
      }
    }

    function updateSpeedGraph() {
      const canvas = document.getElementById('speedGraph');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      const maxWpm = 300;
      const points = 20;
      const stepX = canvas.width / (points - 1);
      const padding = 10;

      window.graphInterval = setInterval(async () => {
        try {
          const response = await fetch('https://procoders.vercel.app/speed-history');
          const speeds = await response.json();

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // Draw background grid
          ctx.strokeStyle = '#E5E7EB';
          ctx.lineWidth = 1;
          for (let i = 1; i < 5; i++) {
            const y = canvas.height - padding - (i * (canvas.height - 2 * padding) / 5);
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(canvas.width - padding, y);
            ctx.stroke();
          }

          // Draw graph
          ctx.strokeStyle = '#3B82F6';
          ctx.lineWidth = 2;
          ctx.beginPath();
          for (let i = 0; i < speeds.length; i++) {
            const x = padding + i * stepX;
            const y = canvas.height - padding - ((speeds[i] / maxWpm) * (canvas.height - 2 * padding));
            if (i === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
          ctx.stroke();

          // Draw labels
          ctx.fillStyle = document.body.classList.contains('dark-theme') ? '#FBBF24' : '#1F2937';
          ctx.font = '10px Poppins';
          ctx.textAlign = 'center';
          ctx.fillText('Time', canvas.width / 2, canvas.height - padding + 15);
          ctx.textAlign = 'right';
          ctx.fillText('WPM', padding - 5, padding + 5);
          ctx.textAlign = 'left';
          ctx.fillText(`${speeds[speeds.length - 1]} WPM`, canvas.width - padding, padding + 15);
        } catch (error) {
          console.error('Speed graph update failed:', error);
        }
      }, 100); // Update every 100ms for live effect
    }

    window.onload = () => {
      loadTheme();
      updateSpeedValue();
      updateTypoValue();
      updateModeLabel();
    };
  </script>
</body>
</html>
